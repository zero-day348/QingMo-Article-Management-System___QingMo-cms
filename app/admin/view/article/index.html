{extend name="layout"}

{block name="content"}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">文章管理</h5>
        <a href="/admin/article/add" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle"></i> 添加文章
        </a>
    </div>
    <div class="card-body">
        <!-- 搜索表单 -->
        <form action="/admin/article" method="get" class="row g-3 mb-4">
            <div class="col-md-4">
                <select name="cid" class="form-select">
                    <option value="0">全部分类</option>
                    {foreach $categoryList as $category}
                    <option value="{$category.id}" {eq name="cid" value="$category.id"}selected{/eq}>{$category.name}</option>
                    {/foreach}
                </select>
            </div>
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" name="title" class="form-control" placeholder="请输入文章标题" value="{$title}">
                    <button class="btn btn-outline-secondary" type="submit">搜索</button>
                </div>
            </div>
        </form>

        <!-- 文章列表 -->
        <div class="table-responsive">
            <table class="table table-hover table-bordered">
                <thead class="table-light">
                    <tr>
                        <th width="5%">ID</th>
                        <th width="20%">标题</th>
                        <th width="10%">分类</th>
                        <th width="10%">作者</th>
                        <th width="10%">阅读量</th>
                        <th width="10%">状态</th>
                        <th width="15%">创建时间</th>
                        <th width="20%">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {foreach $list as $article}
                    <tr>
                        <td>{$article.id}</td>
                        <td>{$article.title}</td>
                        <td>{$article.category.name}</td>
                        <td>{$Think.session.admin_user.nickname}</td>
                        <td>{$article.view}</td>
                        <td>
                            {eq name="article.status" value="1"}
                            <span class="badge bg-success">已发布</span>
                            {else}
                            <span class="badge bg-secondary">草稿</span>
                            {/eq}
                        </td>
                        <td>{$article.create_time}</td>
                        <td>
                            <a href="/admin/article/edit/{$article.id}" class="btn btn-sm btn-outline-primary">编辑</a>
                            <button class="btn btn-sm btn-outline-danger delete-btn" data-id="{$article.id}">删除</button>
                        </td>
                    </tr>
                    {/foreach}
                </tbody>
            </table>
        </div>

        <!-- 分页 -->
        <div class="mt-3">
            {$list->render()}
        </div>
    </div>
</div>
{/block}

{block name="script"}
<script>
$(function() {
    // 删除文章
    $('.delete-btn').click(function() {
        let id = $(this).data('id');
        if (confirm('确定要删除这篇文章吗？删除后不可恢复！')) {
            $.ajax({
                url: '/admin/article/delete/' + id,
                type: 'GET',
                dataType: 'json',
                success: function(res) {
                    alert(res.msg);
                    if (res.code == 1) {
                        window.location.reload();
                    }
                }
            });
        }
    });
});
</script>
{/block}